# 【日志文件使用手册】

## 1.引入依赖

在`pom.xml`文件中导入依赖坐标

```xml
<!-- 日志组件 -->
<dependency>
    <groupId>com.shrcb</groupId>
    <artifactId>bixi-log</artifactId>
</dependency>
```

## 2.配置文件

在项目resources目录下新建`logback.xml`配置文件(spring项目创建`logback-spring.xml`)，可以参考以下配置做适当修改：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true" scanPeriod="10 seconds" debug="false">
    <!-- 日志存放路径 -->
    <property name="log.path" value="./logs"/>
    <!-- 日志归档路径 -->
    <property name="log.path.documentation" value="./logs/documentation"/>
    <!-- 日志输出格式 -->
    <!--
            <encoder>表示对日志进行编码:
            %d{HH:mm:ss.SSS}——日志输出时间
            === 下面的这块不需要配置 ===
                /**
                 * 因为要用自定义的LogUtils.LogInfo方法输出日志，
                 * 就算配置了这块，打印的永远也是LogUtils.LogInfo的方法信息，与实际需要不符
                 * LogUtils.logInfo(等)方法里已经实现了打印调用者方法信息
                 */
                %thread——输出日志的进程名字，这在Web应用以及异步任务处理中很有用
                %-5level——日志级别，并且使用5个字符靠左对齐
                %logger{36}——输出日志的log名，整形参数用于缩短logger名
            === 上面的这块不需要配置 ===
            %msg——日志消息
            %n——平台的换行符
    -->
    <!--
        [2008-09-25 11:11:41,625]
        [DEBUG]
        [com.primeton.eos.foundation.example.LogUtil.logDebug_biz]
        [Line:164]
        Debuger 你好！
    -->
    <property name="log.pattern" value="[%d{yyyy-MM-dd HH:mm:ss.SSS}][%-5level]%msg%n"/>

    <!-- 控制台输出 -->
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <Pattern>${log.pattern}</Pattern>
            <!-- 设置字符集 -->
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <!-- 系统日志输出 -->

    <!-- log info -->
    <appender name="file_info" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${log.path}/sys-info.log</file>
        <!-- 循环政策：基于时间/大小创建日志文件 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- 日志文件归档的文件名 -->
            <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-info.%d{yyyy-MM-dd}.%i.log.zip
            </fileNamePattern>
            <!-- 日志文件保留天数 -->
            <maxHistory>60</maxHistory>
            <!-- 单文件大小 -->
            <maxFileSize>200MB</maxFileSize>
            <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
            <!--<totalSizeCap>20GB</totalSizeCap>-->
            <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
        </rollingPolicy>
        <encoder>
            <pattern>${log.pattern}</pattern>
        </encoder>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!-- 过滤的级别 -->
            <level>INFO</level>
            <!-- 匹配时的操作：接收（记录） -->
            <onMatch>ACCEPT</onMatch>
            <!-- 不匹配时的操作：拒绝（不记录） -->
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <!-- log error -->
    <appender name="file_error" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${log.path}/sys-error.log</file>
        <!-- 循环政策：基于时间/大小创建日志文件 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- 日志文件归档的文件名 -->
            <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-error.%d{yyyy-MM-dd}.%i.log.zip
            </fileNamePattern>
            <!-- 日志文件保留天数 -->
            <maxHistory>60</maxHistory>
            <!-- 单文件大小 -->
            <maxFileSize>200MB</maxFileSize>
            <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
            <!--<totalSizeCap>20GB</totalSizeCap>-->
            <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
        </rollingPolicy>
        <encoder>
            <pattern>${log.pattern}</pattern>
        </encoder>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!-- 过滤的级别 -->
            <level>ERROR</level>
            <!-- 匹配时的操作：接收（记录） -->
            <onMatch>ACCEPT</onMatch>
            <!-- 不匹配时的操作：拒绝（不记录） -->
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <!-- log trace -->
    <appender name="file_trace" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${log.path}/sys-trace.log</file>
        <!-- 循环政策：基于时间/大小创建日志文件 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- 日志文件归档的文件名 -->
            <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-trace.%d{yyyy-MM-dd}.%i.log.zip
            </fileNamePattern>
            <!-- 日志文件保留天数 -->
            <maxHistory>60</maxHistory>
            <!-- 单文件大小 -->
            <maxFileSize>200MB</maxFileSize>
            <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
            <!--<totalSizeCap>20GB</totalSizeCap>-->
            <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
        </rollingPolicy>
        <encoder>
            <pattern>${log.pattern}</pattern>
        </encoder>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!-- 过滤的级别 -->
            <level>TRACE</level>
            <!-- 匹配时的操作：接收（记录） -->
            <onMatch>ACCEPT</onMatch>
            <!-- 不匹配时的操作：拒绝（不记录） -->
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <!-- log debug -->
    <appender name="file_debug" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${log.path}/sys-debug.log</file>
        <!-- 循环政策：基于时间/大小创建日志文件 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- 日志文件归档的文件名 -->
            <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-debug.%d{yyyy-MM-dd}.%i.log.zip
            </fileNamePattern>
            <!-- 日志文件保留天数 -->
            <maxHistory>60</maxHistory>
            <!-- 单文件大小 -->
            <maxFileSize>200MB</maxFileSize>
            <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
            <!--<totalSizeCap>20GB</totalSizeCap>-->
            <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
        </rollingPolicy>
        <encoder>
            <pattern>${log.pattern}</pattern>
        </encoder>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!-- 过滤的级别 -->
            <level>DEBUG</level>
            <!-- 匹配时的操作：接收（记录） -->
            <onMatch>ACCEPT</onMatch>
            <!-- 不匹配时的操作：拒绝（不记录） -->
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <!-- log warn -->
    <appender name="file_warn" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${log.path}/sys-warn.log</file>
        <!-- 循环政策：基于时间/大小创建日志文件 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- 日志文件归档的文件名 -->
            <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-warn.%d{yyyy-MM-dd}.%i.log.zip
            </fileNamePattern>
            <!-- 日志文件保留天数 -->
            <maxHistory>60</maxHistory>
            <!-- 单文件大小 -->
            <maxFileSize>200MB</maxFileSize>
            <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
            <!--<totalSizeCap>20GB</totalSizeCap>-->
            <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
        </rollingPolicy>
        <encoder>
            <pattern>${log.pattern}</pattern>
        </encoder>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!-- 过滤的级别 -->
            <level>WARN</level>
            <!-- 匹配时的操作：接收（记录） -->
            <onMatch>ACCEPT</onMatch>
            <!-- 不匹配时的操作：拒绝（不记录） -->
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <!-- log fatal -->
    <appender name="file_fatal" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${log.path}/sys-fatal.log</file>
        <!-- 循环政策：基于时间/大小创建日志文件 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <!-- 日志文件归档的文件名 -->
            <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-fatal.%d{yyyy-MM-dd}.%i.log.zip
            </fileNamePattern>
            <!-- 日志文件保留天数 -->
            <maxHistory>60</maxHistory>
            <!-- 单文件大小 -->
            <maxFileSize>200MB</maxFileSize>
            <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
            <!--<totalSizeCap>20GB</totalSizeCap>-->
            <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
        </rollingPolicy>
        <encoder>
            <pattern>${log.pattern}</pattern>
        </encoder>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!-- 过滤的级别 -->
            <level>FATAL</level>
            <!-- 匹配时的操作：接收（记录） -->
            <onMatch>ACCEPT</onMatch>
            <!-- 不匹配时的操作：拒绝（不记录） -->
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>

    <!--&lt;!&ndash; 异步输出 &ndash;&gt;-->
    <!--<appender name="ASYNC-INFO" class="ch.qos.logback.classic.AsyncAppender">-->
    <!--    &lt;!&ndash; 不丢失日志.默认的,如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 &ndash;&gt;-->
    <!--    <discardingThreshold>0</discardingThreshold>-->
    <!--    &lt;!&ndash; 更改默认的队列的深度,该值会影响性能.默认值为256 &ndash;&gt;-->
    <!--    <queueSize>256</queueSize>-->
    <!--    &lt;!&ndash; 添加附加的appender,最多只能添加一个 &ndash;&gt;-->
    <!--    <appender-ref ref="file_info"/>-->
    <!--</appender>-->


    <!-- 控制台打印的日志级别开关 -->
    <root level="info">
        <appender-ref ref="console"/>
    </root>
    <!-- 写入日志文件的日志级别开关 -->
    <root level="info">
        <appender-ref ref="file_info"/>
        <appender-ref ref="file_error"/>
        <appender-ref ref="file_trace"/>
        <appender-ref ref="file_debug"/>
        <appender-ref ref="file_warn"/>
        <appender-ref ref="file_fatal"/>
    </root>
    <!-- Spring日志级别开关  -->
    <logger name="org.springframework" level="warn"/>
</configuration>
```

### 2.1 集成spring多环境配置方案

**以dev环境为例子**

1. 在项目resources目录下创建`application-dev.yml`环境的spring配置文件

2. `application.yml`文件中配置当前环境为dev环境

   ```yml
   spring:
     profiles:
       active: dev
   ```

3. 在项目resources目录下创建logback配置文件`logback-spring.xml`

   `<springProfile name="dev">`标签：区分不同环境标签，当前name属性值表示当spring环境为dev环境时启用

   `<incluede resources="xxx">`标签：引入外部的xml文件里的内容（在外部文件里配置dev环境的logback配置文件）

   ```xml
   <?xml version="1.0" encoding="UTF-8"?>
   <configuration scan="true" scanPeriod="10 seconds" debug="false">
       <!-- 开发环境配置 -->
       <springProfile name="dev">
           <!-- 引用开发环境日志配置 -->
           <include resource="./logback/logback-dev.xml"/>
       </springProfile>
       
       <!--
   		-- 生产环境配置 
       	<springProfile name="prod">
           	<include resource="./logback/logback-prod.xml"/>
       	</springProfile>
       -->
       
   </configuration>
   ```

4. 在项目resources目录下创建logback文件夹，在里面创建`logback-dev.xml`，在其中编写配置文件

   可以看到相比原来的配置文件，就是把`<configuration></configuration>`标签写在`logback.xml`里，把`<configuration>`里面的内容写到外部的xml文件，用`<included><included/>`标签包裹来导入

   其他环境的配置文件如法炮制：`logback-prod.xml`、`logback-debug.xml`等

   ```xml
   <included>
       <!-- 日志存放路径 -->
       <property name="log.path" value="./logs"/>
       <!-- 日志归档路径 -->
       <property name="log.path.documentation" value="./logs/documentation"/>
       <!-- 日志输出格式 -->
       <!--
               <encoder>表示对日志进行编码:
               %d{HH:mm:ss.SSS}——日志输出时间
               === 下面的这块不需要配置 ===
                   /**
                    * 因为要用自定义的LogUtils.LogInfo方法输出日志，
                    * 就算配置了这块，打印的永远也是LogUtils.LogInfo的方法信息，与实际需要不符
                    * LogUtils.logInfo(等)方法里已经实现了打印调用者方法信息
                    */
                   %thread——输出日志的进程名字，这在Web应用以及异步任务处理中很有用
                   %-5level——日志级别，并且使用5个字符靠左对齐
                   %logger{36}——输出日志的log名，整形参数用于缩短logger名
               === 上面的这块不需要配置 ===
               %msg——日志消息
               %n——平台的换行符
       -->
       <!--
           [2008-09-25 11:11:41,625]
           [DEBUG]
           [com.primeton.eos.foundation.example.LogUtil.logDebug_biz]
           [Line:164]
           Debuger 你好！
       -->
       <property name="log.pattern" value="[%d{yyyy-MM-dd HH:mm:ss.SSS}][%-5level]%msg%n"/>
   
       <!-- 控制台输出 -->
       <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
           <encoder>
               <Pattern>${log.pattern}</Pattern>
               <!-- 设置字符集 -->
               <charset>UTF-8</charset>
           </encoder>
       </appender>
   
       <!-- 系统日志输出 -->
   
       <!-- log info -->
       <appender name="file_info" class="ch.qos.logback.core.rolling.RollingFileAppender">
           <file>${log.path}/sys-info.log</file>
           <!-- 循环政策：基于时间/大小创建日志文件 -->
           <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
               <!-- 日志文件归档的文件名 -->
               <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-info.%d{yyyy-MM-dd}.%i.log.zip
               </fileNamePattern>
               <!-- 日志文件保留天数 -->
               <maxHistory>60</maxHistory>
               <!-- 单文件大小 -->
               <maxFileSize>200MB</maxFileSize>
               <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
               <!--<totalSizeCap>20GB</totalSizeCap>-->
               <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
           </rollingPolicy>
           <encoder>
               <pattern>${log.pattern}</pattern>
           </encoder>
           <filter class="ch.qos.logback.classic.filter.LevelFilter">
               <!-- 过滤的级别 -->
               <level>INFO</level>
               <!-- 匹配时的操作：接收（记录） -->
               <onMatch>ACCEPT</onMatch>
               <!-- 不匹配时的操作：拒绝（不记录） -->
               <onMismatch>DENY</onMismatch>
           </filter>
       </appender>
   
       <!-- log error -->
       <appender name="file_error" class="ch.qos.logback.core.rolling.RollingFileAppender">
           <file>${log.path}/sys-error.log</file>
           <!-- 循环政策：基于时间/大小创建日志文件 -->
           <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
               <!-- 日志文件归档的文件名 -->
               <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-error.%d{yyyy-MM-dd}.%i.log.zip
               </fileNamePattern>
               <!-- 日志文件保留天数 -->
               <maxHistory>60</maxHistory>
               <!-- 单文件大小 -->
               <maxFileSize>200MB</maxFileSize>
               <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
               <!--<totalSizeCap>20GB</totalSizeCap>-->
               <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
           </rollingPolicy>
           <encoder>
               <pattern>${log.pattern}</pattern>
           </encoder>
           <filter class="ch.qos.logback.classic.filter.LevelFilter">
               <!-- 过滤的级别 -->
               <level>ERROR</level>
               <!-- 匹配时的操作：接收（记录） -->
               <onMatch>ACCEPT</onMatch>
               <!-- 不匹配时的操作：拒绝（不记录） -->
               <onMismatch>DENY</onMismatch>
           </filter>
       </appender>
   
       <!-- log trace -->
       <appender name="file_trace" class="ch.qos.logback.core.rolling.RollingFileAppender">
           <file>${log.path}/sys-trace.log</file>
           <!-- 循环政策：基于时间/大小创建日志文件 -->
           <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
               <!-- 日志文件归档的文件名 -->
               <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-trace.%d{yyyy-MM-dd}.%i.log.zip
               </fileNamePattern>
               <!-- 日志文件保留天数 -->
               <maxHistory>60</maxHistory>
               <!-- 单文件大小 -->
               <maxFileSize>200MB</maxFileSize>
               <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
               <!--<totalSizeCap>20GB</totalSizeCap>-->
               <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
           </rollingPolicy>
           <encoder>
               <pattern>${log.pattern}</pattern>
           </encoder>
           <filter class="ch.qos.logback.classic.filter.LevelFilter">
               <!-- 过滤的级别 -->
               <level>TRACE</level>
               <!-- 匹配时的操作：接收（记录） -->
               <onMatch>ACCEPT</onMatch>
               <!-- 不匹配时的操作：拒绝（不记录） -->
               <onMismatch>DENY</onMismatch>
           </filter>
       </appender>
   
       <!-- log debug -->
       <appender name="file_debug" class="ch.qos.logback.core.rolling.RollingFileAppender">
           <file>${log.path}/sys-debug.log</file>
           <!-- 循环政策：基于时间/大小创建日志文件 -->
           <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
               <!-- 日志文件归档的文件名 -->
               <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-debug.%d{yyyy-MM-dd}.%i.log.zip
               </fileNamePattern>
               <!-- 日志文件保留天数 -->
               <maxHistory>60</maxHistory>
               <!-- 单文件大小 -->
               <maxFileSize>200MB</maxFileSize>
               <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
               <!--<totalSizeCap>20GB</totalSizeCap>-->
               <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
           </rollingPolicy>
           <encoder>
               <pattern>${log.pattern}</pattern>
           </encoder>
           <filter class="ch.qos.logback.classic.filter.LevelFilter">
               <!-- 过滤的级别 -->
               <level>DEBUG</level>
               <!-- 匹配时的操作：接收（记录） -->
               <onMatch>ACCEPT</onMatch>
               <!-- 不匹配时的操作：拒绝（不记录） -->
               <onMismatch>DENY</onMismatch>
           </filter>
       </appender>
   
       <!-- log warn -->
       <appender name="file_warn" class="ch.qos.logback.core.rolling.RollingFileAppender">
           <file>${log.path}/sys-warn.log</file>
           <!-- 循环政策：基于时间/大小创建日志文件 -->
           <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
               <!-- 日志文件归档的文件名 -->
               <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-warn.%d{yyyy-MM-dd}.%i.log.zip
               </fileNamePattern>
               <!-- 日志文件保留天数 -->
               <maxHistory>60</maxHistory>
               <!-- 单文件大小 -->
               <maxFileSize>200MB</maxFileSize>
               <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
               <!--<totalSizeCap>20GB</totalSizeCap>-->
               <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
           </rollingPolicy>
           <encoder>
               <pattern>${log.pattern}</pattern>
           </encoder>
           <filter class="ch.qos.logback.classic.filter.LevelFilter">
               <!-- 过滤的级别 -->
               <level>WARN</level>
               <!-- 匹配时的操作：接收（记录） -->
               <onMatch>ACCEPT</onMatch>
               <!-- 不匹配时的操作：拒绝（不记录） -->
               <onMismatch>DENY</onMismatch>
           </filter>
       </appender>
   
       <!-- log fatal -->
       <appender name="file_fatal" class="ch.qos.logback.core.rolling.RollingFileAppender">
           <file>${log.path}/sys-fatal.log</file>
           <!-- 循环政策：基于时间/大小创建日志文件 -->
           <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
               <!-- 日志文件归档的文件名 -->
               <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-fatal.%d{yyyy-MM-dd}.%i.log.zip
               </fileNamePattern>
               <!-- 日志文件保留天数 -->
               <maxHistory>60</maxHistory>
               <!-- 单文件大小 -->
               <maxFileSize>200MB</maxFileSize>
               <!-- 指定日志文件的大小上限，超出值会删除旧日志 -->
               <!--<totalSizeCap>20GB</totalSizeCap>-->
               <!--<cleanHistoryOnStart>true</cleanHistoryOnStart>-->
           </rollingPolicy>
           <encoder>
               <pattern>${log.pattern}</pattern>
           </encoder>
           <filter class="ch.qos.logback.classic.filter.LevelFilter">
               <!-- 过滤的级别 -->
               <level>FATAL</level>
               <!-- 匹配时的操作：接收（记录） -->
               <onMatch>ACCEPT</onMatch>
               <!-- 不匹配时的操作：拒绝（不记录） -->
               <onMismatch>DENY</onMismatch>
           </filter>
       </appender>
   
       <!--&lt;!&ndash; 异步输出 &ndash;&gt;-->
       <!--<appender name="ASYNC-INFO" class="ch.qos.logback.classic.AsyncAppender">-->
       <!--    &lt;!&ndash; 不丢失日志.默认的,如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 &ndash;&gt;-->
       <!--    <discardingThreshold>0</discardingThreshold>-->
       <!--    &lt;!&ndash; 更改默认的队列的深度,该值会影响性能.默认值为256 &ndash;&gt;-->
       <!--    <queueSize>256</queueSize>-->
       <!--    &lt;!&ndash; 添加附加的appender,最多只能添加一个 &ndash;&gt;-->
       <!--    <appender-ref ref="file_info"/>-->
       <!--</appender>-->
   
   
       <!-- 控制台打印的日志级别开关 -->
       <root level="info">
           <appender-ref ref="console"/>
       </root>
       <!-- 写入日志文件的日志级别开关 -->
       <root level="info">
           <appender-ref ref="file_info"/>
           <appender-ref ref="file_error"/>
           <appender-ref ref="file_trace"/>
           <appender-ref ref="file_debug"/>
           <appender-ref ref="file_warn"/>
           <appender-ref ref="file_fatal"/>
       </root>
       <!-- Spring日志级别开关  -->
       <logger name="org.springframework" level="warn"/>
   </included>
   ```

5. 项目结构当如下：

   ![image-20230523144836448](https://chongming-images.oss-cn-hangzhou.aliyuncs.com/images-masterimage-20230523144836448.png)

   需要切换环境，只需要切换spring的环境，即修改`spring.profiles.active`属性值即可

## 3.普通方法调用

> 方法包名：`com.shrcb.bixi.log.LogUtils`

`LogUtils.jar`提供了以下日志记录日志方法

- `logInfo(String order, String message, Throwable cause, Object... params)`
- `logDebug(String order, String message, Throwable cause, Object... params)`
- `logWarn(String order, String message, Throwable cause, Object... params)`
- `logError(String order, String message, Throwable cause, Object... params)`

**参数说明：**

- `String order`：流水号，不需要可不写

- `String message`：需要日志打印的信息，可以使用`{}`占位符，配置`Object... params`使用，（不能为空）
- `Throwable cause`：异常信息，传入方法的异常信息会追加在日志信息后面，不需要可不写
- `Object... params`：日志信息参数，可以传入多个参数，参数位置应当和`message`中的`{}`位置一一对应，不需要可不写

**使用举例：**

```java
LogUtils.logInfo("123456", info,{},{}", new LogException(), "hello", "world");
```

日志样式：

```java
[2023-05-23 15:00:06.566][INFO ][com.example.demo.DemoApplicationTests.contextLoads][Line:14][order:1234] info,hello,world
====== Exception Info Start ======
com.eos.foundation.eoscommon.LogException
	at com.example.demo.DemoApplicationTests.contextLoads(DemoApplicationTests.java:14)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	......
======= Exception Info End =======
```

## 4.国际化方法调用

### 4.1 配置

使用国际化方法需要创建配置文件

**默认配置：**

在项目resources目录下创建META-INF/resources/i18n文件夹，在文件下创建`i18n.properties`文件

**目录结构：**

![image-20230523150356512](https://chongming-images.oss-cn-hangzhou.aliyuncs.com/images-masterimage-20230523150356512.png)

**自定义i18n目录和文件名：**

```java
I8nConfig.setI18nFilePath("i18n");
I18nConfig.setI18nFileName("i18n.properties");
```

### 4.2 使用

`LogUtils.jar`提供了以下国际化方法：

- `logI18NInfo(String order, String code, Throwable cause, Object... params)`
- `logI18NDebug(String order, String code, Throwable cause, Object... params)`
- `logI18NWarn(String order, String code, Throwable cause, Object... params)`
- `logI18NError(String order, String code, Throwable cause, Object... params)`

**参数说明：**

- `String order`：流水号，不需要可不写
- `String code`：国际化信息代码，通过`code`获取`message`，`code`与`message`对应关系写在`i18n.properties`中
- `Throwable cause`：异常信息，传入方法的异常信息会追加在日志信息后面，不需要可不写
- `Object... params` 日志信息参数，可以传入多个参数，参数位置应当和`code`对应的`message`中的`{}`位置一一对应，不需要可不写

**使用举例：**

1. 在`i18n.properties`中写入`code=message`属性（一行一对）：

   ```properties
   msg_001=info {} {}
   ```

2. 调用方法：

   ```java
   LogUtils.logI18NInfo("123456", "msg_001", new LogException(), "hello", "world");
   ```

3. 日志样式:

   ```java
   [2023-05-23 15:10:44.740][INFO ][com.example.demo.DemoApplicationTests.contextLoads][Line:20][order:123456] info hello world
   ====== Exception Info Start ======
   com.eos.foundation.eoscommon.LogException
   	at com.example.demo.DemoApplicationTests.contextLoads(DemoApplicationTests.java:20)
   	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
   	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
   	......
   ======= Exception Info End =======
   ```


## 5.脱敏组件使用说明

由于有的数据存在敏感信息，比如：身份证号码，手机号码，邮箱等等，因此在打印日志，以及生成日志文件时，需要对这些进行脱敏。

以下是使用步骤

### 5.1 配置logback.xml

使用脱敏组件需要替换日志原有的Appender类，以控制台(console)和Info级别日志为例：

修改对应`<appender name="console">`和`<appender name="file_info">`标签的`class`属性，替换为添加脱敏功能的Appender类：

- `com.eos.foundation.eoscommon.DesensitizeConsoleAppender`：控制台脱敏
- `com.eos.foundation.eoscommon.DesensitizeRollingFileAppender`：日志文件脱敏

```xml
<!-- 控制台输出 -->
						 <!-- 替换这里的calss -->
<appender name="console" class="com.eos.foundation.eoscommon.DesensitizeConsoleAppender">
    <encoder>
        <Pattern>${log.pattern}</Pattern>
        <charset>UTF-8</charset>
    </encoder>
</appender>

<!-- log info -->
						  <!-- 替换这里的calss -->
<appender name="file_info" class="com.eos.foundation.eoscommon.DesensitizeRollingFileAppender">
    <file>${log.path}/sys-info.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
        <fileNamePattern>${log.path.documentation}/%d{yyyy-MMdd}/sys-info.%d{yyyy-MM-dd}.%i.log.zip
        </fileNamePattern>
        <maxHistory>60</maxHistory>
        <maxFileSize>200MB</maxFileSize>
    </rollingPolicy>
    <encoder>
        <pattern>${log.pattern}</pattern>
    </encoder>
    <filter class="ch.qos.logback.classic.filter.LevelFilter">
        <level>INFO</level>
        <onMatch>ACCEPT</onMatch>
        <onMismatch>DENY</onMismatch>
    </filter>
</appender>
```

### 5.2 配置扫描路径

如果需要，可以指定哪些包下的类需要脱敏，默认为`com`下包全部适用

```java
DesensitizeConfig.setBasePackage("com.example.demo");
```

### 5.3 @Desensitize注解

针对要脱敏的属性，添加`@Desesnsitize`注解

```java
public class TestPojo {
    @Desensitize(type = DesensitizeTypeEnum.USERNAME, length = 4)
    private String username;
    @Desensitize(type = DesensitizeTypeEnum.PASSWORD)
    private String password;
}
```

`@Desesnsitize`注解有两个属性：

- `type`：设置属性的类型，针对不同类型有不同的脱敏效果，默认为`CUSTOM`
- `length`：设置脱敏替换文本`*`的个数，默认为-1，不设置则使用`type`的默认配置

**type类型及说明：**

替换规则：

- `PASSWORD`、`PRICE`、`CUSTOM`替换全部字符串
- 其余为替换中间部分字符

|               枚举值                |                          说明                          |
| :---------------------------------: | :----------------------------------------------------: |
|         `EMAIL("EMAIL", 4)`         |                        邮箱脱敏                        |
|         `PHONE("PHONE", 4)`         |                       手机号脱敏                       |
|      `USERNAME("USERNAME", 2)`      |                       用户名脱敏                       |
|      `PASSWORD("PASSWORD", 6)`      |                        密码脱敏                        |
| `ACCOUNTNUMBER("ACCOUNTNUMBER", 8)` |                        号码脱敏                        |
|         `PRICE("PRICE", 2)`         |                        价格脱敏                        |
|        `CUSTOM("CUSTOM", 2)`        |                        顾客脱敏                        |
|   `COLLECTION("COLLECTION", -1)`    | 对集合中所有元素脱敏（需要对元素中相应属性需配置注解） |

### 5.4 使用演示

配置好后正常使用方法，最后打印结果会进行脱敏处理：

```java
@Test
void test() {
    // 配置脱敏扫描包
    DesensitizeConfig.setBasePackage("com.example.demo");
    
    TestPojo testPojo = new TestPojo();
    // 已对username属性添加@Desensitize注解
    testPojo.setUsername("重明鸟");
    logInfo(null, "对象：{}", new Throwable(), testPojo);
}
```

```java
[2023-05-24 13:18:41.087][INFO ][com.example.demo.DemoApplicationTests.test][Line:22] 对象：{username=***}
====== Exception Info Start ======
java.lang.Throwable
	at com.example.demo.DemoApplicationTests.test(DemoApplicationTests.java:22)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
......
======= Exception Info End =======
```

